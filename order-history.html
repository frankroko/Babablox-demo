<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ประวัติการสั่งซื้อ - Babablox</title>
    <link rel="stylesheet" href="style.css">
    <style>
        .order-history-container {
            max-width: 1000px;
            margin: 50px auto;
            padding: 20px;
        }
        .order-history-header {
            text-align: center;
            margin-bottom: 30px;
        }
        .order-history-header h1 {
            color: #4a0080;
            font-size: 2.5rem;
        }
        .order-item {
            background: white;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            padding: 20px;
            margin-bottom: 20px;
            border-left: 5px solid #ff6b00;
        }
        .order-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
            padding-bottom: 15px;
            border-bottom: 1px solid #e0e0e0;
        }
        .order-number {
            font-weight: bold;
            color: #4a0080;
            font-size: 1.1rem;
        }
        .order-date {
            color: #666;
            font-size: 0.9rem;
        }
        .order-status {
            background-color: #4caf50;
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9rem;
            font-weight: bold;
        }
        .order-items-list {
            margin-bottom: 15px;
        }
        .order-product {
            display: flex;
            justify-content: space-between;
            padding: 10px 0;
            border-bottom: 1px solid #f0f0f0;
        }
        .order-product:last-child {
            border-bottom: none;
        }
        .product-info h4 {
            color: #4a0080;
            margin-bottom: 5px;
        }
        .product-info p {
            color: #666;
            font-size: 0.9rem;
        }
        .product-total {
            color: #ff6b00;
            font-weight: bold;
            font-size: 1.1rem;
        }
        .order-total {
            text-align: right;
            font-size: 1.2rem;
            font-weight: bold;
            color: #4a0080;
            padding-top: 15px;
            border-top: 2px solid #e0e0e0;
        }
        .order-empty {
            text-align: center;
            padding: 40px;
            background: white;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            color: #666;
        }
    </style>
</head>
<body>
    <header>
        <nav class="navbar">
            <a href="index.html" class="logo">Babablox</a>
            <ul class="nav-links">
                <li><a href="index.html">Home</a></li>
                <li><a href="cart.html">ตระกร้า</a></li>
                <li><a href="order-history.html">ประวัติการสั่งซื้อ</a></li>
                <li><a href="https://line.me/ti/p/mrgy7EasBd" target="_blank">Contact</a></li>
                <li id="navAuthLinks">
                    <a href="login.html" class="login-link">Login</a> | <a href="register.html">Sign Up</a>
                </li>
                <li id="navUserProfile" style="display: none;">
                    <span id="userGreeting"></span> | <a href="#" id="logoutBtn">Logout</a>
                </li>
            </ul>
        </nav>
    </header>

    <div class="order-history-container">
        <div class="order-history-header">
            <h1>ประวัติการสั่งซื้อ</h1>
        </div>

        <div id="ordersContainer">
            <!-- Orders will be dynamically added here -->
        </div>
    </div>

    <footer>
        <p>&copy; 2026 Babablox. All rights reserved.</p>
    </footer>

    <script>
        // Load and display order history
        function loadOrderHistory() {
            const orderHistory = JSON.parse(localStorage.getItem('orderHistory')) || [];
            const ordersContainer = document.getElementById('ordersContainer');

            if (orderHistory.length === 0) {
                ordersContainer.innerHTML = '<div class="order-empty"><p>ยังไม่มีคำสั่งซื้อ <a href="index.html">เริ่มการช้อปปิ้ง</a></p></div>';
                return;
            }

            let html = '';
            orderHistory.forEach((order, index) => {
                const orderNumber = 'ORD-' + String(1000 + index).padStart(4, '0');
                const orderDate = new Date(order.date).toLocaleDateString('en-US', {
                    year: 'numeric',
                    month: 'long',
                    day: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                });

                let itemsHtml = '';
                order.items.forEach(item => {
                    const itemTotal = item.price * item.quantity;
                    itemsHtml += `
                        <div class="order-product">
                            <div class="product-info">
                                <h4>${item.name}</h4>
                                <p>จำนวน: ${item.quantity} × ฿${item.price}</p>
                            </div>
                            <div class="product-total">฿${itemTotal.toFixed(2)}</div>
                        </div>
                    `;
                });

                html += `
                    <div class="order-item">
                        <div class="order-header">
                            <div>
                                <div class="order-number">${orderNumber}</div>
                                <div class="order-date">${orderDate}</div>
                            </div>
                            <div class="order-status">สำเร็จ</div>
                        </div>
                        <div class="order-items-list">
                            ${itemsHtml}
                        </div>
                        <div class="order-total">
                            รวมทั้งสิ้น: ฿${order.total.toFixed(2)}
                        </div>
                    </div>
                `;
            });

            ordersContainer.innerHTML = html;
        }

        // Check login status
        function checkLoginStatus() {
            const isLoggedIn = localStorage.getItem('isLoggedIn');
            const currentUser = localStorage.getItem('currentUser');

            const navAuthLinks = document.getElementById('navAuthLinks');
            const navUserProfile = document.getElementById('navUserProfile');
            const userGreeting = document.getElementById('userGreeting');

            if (isLoggedIn === 'true' && currentUser) {
                const user = JSON.parse(currentUser);
                const displayName = user.firstname || user.email.split('@')[0];

                navAuthLinks.style.display = 'none';
                navUserProfile.style.display = 'block';
                userGreeting.textContent = `Welcome, ${displayName}!`;

                document.getElementById('logoutBtn').addEventListener('click', function(event) {
                    event.preventDefault();
                    logout();
                });
            } else {
                navAuthLinks.style.display = 'block';
                navUserProfile.style.display = 'none';
            }
        }

        function logout() {
            localStorage.removeItem('currentUser');
            localStorage.removeItem('isLoggedIn');
            alert('You have been logged out.');
            window.location.reload();
        }

        // Initialize on page load
        window.addEventListener('DOMContentLoaded', function() {
            checkLoginStatus();
            loadOrderHistory();
        });
    </script>
</body>
</html>
